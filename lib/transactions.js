"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.payment = payment;
exports.close = close;
exports.registerKeyOnline = registerKeyOnline;
exports.registerKeyOffline = registerKeyOffline;
exports.assetCreate = assetCreate;
exports.assetConfigure = assetConfigure;
exports.assetDestroy = assetDestroy;
exports.assetOptIn = assetOptIn;
exports.assetTransfer = assetTransfer;
exports.assetRevoke = assetRevoke;
exports.assetFreeze = assetFreeze;
exports["default"] = void 0;

var _v8n = _interopRequireDefault(require("v8n"));

var _rules = _interopRequireDefault(require("./rules"));

var _constants = require("./utils/constants");

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { "default": obj }; }

function ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }

function _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }

function _defineProperty(obj, key, value) { if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }

// Fields that are optional for any txn
var TXN_OPTIONAL_FIELDS = {
  genesisID: (0, _v8n["default"])().optional(_rules["default"].genesisID),
  fee: (0, _v8n["default"])().optional(_rules["default"].fee),
  note: (0, _v8n["default"])().optional(_rules["default"].note),
  lease: (0, _v8n["default"])().optional(_rules["default"].lease),
  group: (0, _v8n["default"])().optional(_rules["default"].group),
  reKeyTo: (0, _v8n["default"])().optional(_rules["default"].algoAddress)
}; // Fields required for any txn

var TXN_REQUIRED_FIELDS = {
  firstRound: _rules["default"].firstRound,
  lastRound: _rules["default"].lastRound,
  genesisHash: _rules["default"].genesisHash
}; // Standard checks for all transactions

function standardTxnValidation(txn) {
  var roundsValid = txn.lastRound > txn.firstRound;
  return roundsValid;
}
/**
 * Test for a valid payment transaction payload
 * @category Transactions
 * @param {object}
 * @returns {boolean}
 */


function payment(txn) {
  var PAY_TXN_SCHEMA = (0, _v8n["default"])().schema(_objectSpread({
    to: (0, _v8n["default"])().optional(_rules["default"].algoAddress),
    amount: (0, _v8n["default"])().optional(_rules["default"].amount),
    from: _rules["default"].algoAddress,
    type: (0, _v8n["default"])().string().exact(_constants.TRANSACTION_TYPES.PAY)
  }, TXN_REQUIRED_FIELDS, {}, TXN_OPTIONAL_FIELDS));
  return PAY_TXN_SCHEMA.test(txn) && standardTxnValidation(txn);
}
/**
 * Test for a valid close account transaction payload
 * @category Transactions
 * @param {object}
 * @returns {boolean}
 */


function close(txn) {
  var CLOSE_TXN_SCHEMA = (0, _v8n["default"])().schema(_objectSpread({
    closeRemainderTo: _rules["default"].algoAddress,
    from: _rules["default"].algoAddress,
    to: _rules["default"].algoAddress,
    type: (0, _v8n["default"])().string().exact(_constants.TRANSACTION_TYPES.PAY)
  }, TXN_REQUIRED_FIELDS, {}, TXN_OPTIONAL_FIELDS)); // No closing and sending from the same address

  var isNotSameAddress = txn.closeRemainderTo !== txn.from;
  return CLOSE_TXN_SCHEMA.test(txn) && standardTxnValidation(txn) && isNotSameAddress;
}
/**
 * Test for a valid online key registration transaction payload
 * @category Transactions
 * @param {object}
 * @returns {boolean}
 */


function registerKeyOnline(txn) {
  var isValid = (0, _v8n["default"])().schema(_objectSpread({
    selectionKey: _rules["default"].selectionKey,
    from: _rules["default"].algoAddress,
    voteFirst: _rules["default"].voteFirst,
    voteKeyDilution: _rules["default"].voteKeyDilution,
    voteKey: _rules["default"].voteKey,
    voteLast: _rules["default"].voteLast,
    type: (0, _v8n["default"])().string().exact(_constants.TRANSACTION_TYPES.KEYREG)
  }, TXN_REQUIRED_FIELDS, {}, TXN_OPTIONAL_FIELDS)); // Vote first must be less than vote last

  var isNotSameAddress = txn.voteFirst < txn.voteLast;
  return isValid.test(txn) && standardTxnValidation(txn);
}
/**
 * Test for a valid offline key registration transaction payload
 * @category Transactions
 * @param {object}
 * @returns {boolean}
 */


function registerKeyOffline(txn) {
  var isValid = (0, _v8n["default"])().schema(_objectSpread({
    from: _rules["default"].algoAddress,
    type: (0, _v8n["default"])().string().exact(_constants.TRANSACTION_TYPES.KEYREG)
  }, TXN_REQUIRED_FIELDS, {}, TXN_OPTIONAL_FIELDS));
  return isValid.test(txn) && standardTxnValidation(txn);
}
/**
 * Test for a valid asset creation transaction payload
 * @category Transactions
 * @param {object}
 * @returns {boolean}
 */


function assetCreate(txn) {
  var isValid = (0, _v8n["default"])().schema(_objectSpread({
    assetMetadataHash: (0, _v8n["default"])().string(),
    assetName: _rules["default"].assetName,
    assetURL: _rules["default"].assetURL,
    assetClawback: _rules["default"].algoAddress,
    assetDecimals: _rules["default"].assetDecimals,
    assetFreeze: _rules["default"].algoAddress,
    assetManager: _rules["default"].algoAddress,
    assetReserve: _rules["default"].algoAddress,
    assetTotal: _rules["default"].assetTotal,
    assetUnitName: _rules["default"].assetUnitName,
    from: _rules["default"].algoAddress,
    type: (0, _v8n["default"])().string().exact(_constants.TRANSACTION_TYPES.ACFG)
  }, TXN_REQUIRED_FIELDS, {}, TXN_OPTIONAL_FIELDS));
  return isValid.test(txn) && standardTxnValidation(txn);
}
/**
 * Test for a valid asset configuration transaction payload
 * @category Transactions
 * @param {object}
 * @returns {boolean}
 */


function assetConfigure(txn) {
  var isValid = (0, _v8n["default"])().schema(_objectSpread({
    assetClawback: _rules["default"].algoAddress,
    assetFreeze: _rules["default"].algoAddress,
    assetManager: _rules["default"].algoAddress,
    assetReserve: _rules["default"].algoAddress,
    assetIndex: _rules["default"].assetIndex,
    from: _rules["default"].algoAddress,
    type: (0, _v8n["default"])().string().exact(_constants.TRANSACTION_TYPES.ACFG)
  }, TXN_REQUIRED_FIELDS, {}, TXN_OPTIONAL_FIELDS));
  return isValid.test(txn) && standardTxnValidation(txn);
}
/**
 * Test for a valid asset destroy transaction payload
 * @category Transactions
 * @param {object}
 * @returns {boolean}
 */


function assetDestroy(txn) {
  var isValid = (0, _v8n["default"])().schema(_objectSpread({
    assetIndex: _rules["default"].assetIndex,
    from: _rules["default"].algoAddress,
    type: (0, _v8n["default"])().string().exact(_constants.TRANSACTION_TYPES.ACFG)
  }, TXN_REQUIRED_FIELDS, {}, TXN_OPTIONAL_FIELDS));
  return isValid.test(txn) && standardTxnValidation(txn);
}
/**
 * Test for a valid asset opt-in transaction payload
 * @category Transactions
 * @param {object}
 * @returns {boolean}
 */


function assetOptIn(txn) {
  var isValid = (0, _v8n["default"])().schema(_objectSpread({
    to: _rules["default"].algoAddress,
    from: _rules["default"].algoAddress,
    type: (0, _v8n["default"])().string().exact(_constants.TRANSACTION_TYPES.AXFER),
    assetIndex: _rules["default"].assetIndex
  }, TXN_REQUIRED_FIELDS, {}, TXN_OPTIONAL_FIELDS));
  return isValid.test(txn) && standardTxnValidation(txn);
}
/**
 * Test for a valid asset transfer transaction payload
 * @category Transactions
 * @param {object}
 * @returns {boolean}
 */


function assetTransfer(txn) {
  var isValid = (0, _v8n["default"])().schema(_objectSpread({
    amount: _rules["default"].amount,
    to: _rules["default"].algoAddress,
    from: _rules["default"].algoAddress,
    assetIndex: _rules["default"].assetIndex,
    type: (0, _v8n["default"])().string().exact(_constants.TRANSACTION_TYPES.AXFER)
  }, TXN_REQUIRED_FIELDS, {}, TXN_OPTIONAL_FIELDS));
  return isValid.test(txn) && standardTxnValidation(txn);
}
/**
 * Test for a valid revoke asset transaction payload
 * @category Transactions
 * @param {object}
 * @returns {boolean}
 */


function assetRevoke(txn) {
  var isValid = (0, _v8n["default"])().schema(_objectSpread({
    amount: _rules["default"].amount,
    to: _rules["default"].algoAddress,
    assetRevocationTarget: _rules["default"].algoAddress,
    from: _rules["default"].algoAddress,
    assetIndex: _rules["default"].assetIndex,
    type: (0, _v8n["default"])().string().exact(_constants.TRANSACTION_TYPES.AXFER)
  }, TXN_REQUIRED_FIELDS, {}, TXN_OPTIONAL_FIELDS));
  return isValid.test(txn) && standardTxnValidation(txn);
}
/**
 * Test for a valid freeze asset transaction payload
 * @category Transactions
 * @param {object}
 * @returns {boolean}
 */


function assetFreeze(txn) {
  var isValid = (0, _v8n["default"])().schema(_objectSpread({
    freezeState: _rules["default"].freezeState,
    freezeAccount: _rules["default"].algoAddress,
    assetIndex: _rules["default"].assetIndex,
    from: _rules["default"].algoAddress,
    type: (0, _v8n["default"])().string().exact(_constants.TRANSACTION_TYPES.AFRZ)
  }, TXN_REQUIRED_FIELDS, {}, TXN_OPTIONAL_FIELDS));
  return isValid.test(txn) && standardTxnValidation(txn);
}

var _default = {
  payment: payment,
  close: close,
  registerKeyOnline: registerKeyOnline,
  registerKeyOffline: registerKeyOffline,
  assetCreate: assetCreate,
  assetConfigure: assetConfigure,
  assetDestroy: assetDestroy,
  assetOptIn: assetOptIn,
  assetTransfer: assetTransfer,
  assetRevoke: assetRevoke,
  assetFreeze: assetFreeze
};
exports["default"] = _default;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uL3NyYy90cmFuc2FjdGlvbnMudHMiXSwibmFtZXMiOlsiVFhOX09QVElPTkFMX0ZJRUxEUyIsImdlbmVzaXNJRCIsIm9wdGlvbmFsIiwicnVsZXMiLCJmZWUiLCJub3RlIiwibGVhc2UiLCJncm91cCIsInJlS2V5VG8iLCJhbGdvQWRkcmVzcyIsIlRYTl9SRVFVSVJFRF9GSUVMRFMiLCJmaXJzdFJvdW5kIiwibGFzdFJvdW5kIiwiZ2VuZXNpc0hhc2giLCJzdGFuZGFyZFR4blZhbGlkYXRpb24iLCJ0eG4iLCJyb3VuZHNWYWxpZCIsInBheW1lbnQiLCJQQVlfVFhOX1NDSEVNQSIsInNjaGVtYSIsInRvIiwiYW1vdW50IiwiZnJvbSIsInR5cGUiLCJzdHJpbmciLCJleGFjdCIsIlRSQU5TQUNUSU9OX1RZUEVTIiwiUEFZIiwidGVzdCIsImNsb3NlIiwiQ0xPU0VfVFhOX1NDSEVNQSIsImNsb3NlUmVtYWluZGVyVG8iLCJpc05vdFNhbWVBZGRyZXNzIiwicmVnaXN0ZXJLZXlPbmxpbmUiLCJpc1ZhbGlkIiwic2VsZWN0aW9uS2V5Iiwidm90ZUZpcnN0Iiwidm90ZUtleURpbHV0aW9uIiwidm90ZUtleSIsInZvdGVMYXN0IiwiS0VZUkVHIiwicmVnaXN0ZXJLZXlPZmZsaW5lIiwiYXNzZXRDcmVhdGUiLCJhc3NldE1ldGFkYXRhSGFzaCIsImFzc2V0TmFtZSIsImFzc2V0VVJMIiwiYXNzZXRDbGF3YmFjayIsImFzc2V0RGVjaW1hbHMiLCJhc3NldEZyZWV6ZSIsImFzc2V0TWFuYWdlciIsImFzc2V0UmVzZXJ2ZSIsImFzc2V0VG90YWwiLCJhc3NldFVuaXROYW1lIiwiQUNGRyIsImFzc2V0Q29uZmlndXJlIiwiYXNzZXRJbmRleCIsImFzc2V0RGVzdHJveSIsImFzc2V0T3B0SW4iLCJBWEZFUiIsImFzc2V0VHJhbnNmZXIiLCJhc3NldFJldm9rZSIsImFzc2V0UmV2b2NhdGlvblRhcmdldCIsImZyZWV6ZVN0YXRlIiwiZnJlZXplQWNjb3VudCIsIkFGUloi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RCxVQUhKO0FBSWRqQyxJQUFBQSxJQUFJLEVBQUVuQixrQkFBTU0sV0FKRTtBQUtkYyxJQUFBQSxJQUFJLEVBQUUsdUJBQ0hDLE1BREcsR0FFSEMsS0FGRyxDQUVHQyw2QkFBa0JzQyxJQUZyQjtBQUxRLEtBUVh0RCxtQkFSVyxNQVNYVixtQkFUVyxFQUFoQjtBQVdBLFNBQU9rQyxPQUFPLENBQUNOLElBQVIsQ0FBYWIsR0FBYixLQUFxQkQscUJBQXFCLENBQUNDLEdBQUQsQ0FBakQ7QUFDRDs7ZUFFYztBQUNiRSxFQUFBQSxPQUFPLEVBQVBBLE9BRGE7QUFFYlksRUFBQUEsS0FBSyxFQUFMQSxLQUZhO0FBR2JJLEVBQUFBLGlCQUFpQixFQUFqQkEsaUJBSGE7QUFJYlEsRUFBQUEsa0JBQWtCLEVBQWxCQSxrQkFKYTtBQUtiQyxFQUFBQSxXQUFXLEVBQVhBLFdBTGE7QUFNYlksRUFBQUEsY0FBYyxFQUFkQSxjQU5hO0FBT2JFLEVBQUFBLFlBQVksRUFBWkEsWUFQYTtBQVFiQyxFQUFBQSxVQUFVLEVBQVZBLFVBUmE7QUFTYkUsRUFBQUEsYUFBYSxFQUFiQSxhQVRhO0FBVWJDLEVBQUFBLFdBQVcsRUFBWEEsV0FWYTtBQVdiWixFQUFBQSxXQUFXLEVBQVhBO0FBWGEsQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB2OG4gZnJvbSAndjhuJztcbmltcG9ydCBydWxlcyBmcm9tICcuL3J1bGVzJztcbmltcG9ydCB7IFRSQU5TQUNUSU9OX1RZUEVTIH0gZnJvbSAnLi91dGlscy9jb25zdGFudHMnO1xuXG4vLyBGaWVsZHMgdGhhdCBhcmUgb3B0aW9uYWwgZm9yIGFueSB0eG5cbmNvbnN0IFRYTl9PUFRJT05BTF9GSUVMRFMgPSB7XG4gIGdlbmVzaXNJRDogdjhuKCkub3B0aW9uYWwocnVsZXMuZ2VuZXNpc0lEKSxcbiAgZmVlOiB2OG4oKS5vcHRpb25hbChydWxlcy5mZWUpLFxuICBub3RlOiB2OG4oKS5vcHRpb25hbChydWxlcy5ub3RlKSxcbiAgbGVhc2U6IHY4bigpLm9wdGlvbmFsKHJ1bGVzLmxlYXNlKSxcbiAgZ3JvdXA6IHY4bigpLm9wdGlvbmFsKHJ1bGVzLmdyb3VwKSxcbiAgcmVLZXlUbzogdjhuKCkub3B0aW9uYWwocnVsZXMuYWxnb0FkZHJlc3MpXG59O1xuXG4vLyBGaWVsZHMgcmVxdWlyZWQgZm9yIGFueSB0eG5cbmNvbnN0IFRYTl9SRVFVSVJFRF9GSUVMRFMgPSB7XG4gIGZpcnN0Um91bmQ6IHJ1bGVzLmZpcnN0Um91bmQsXG4gIGxhc3RSb3VuZDogcnVsZXMubGFzdFJvdW5kLFxuICBnZW5lc2lzSGFzaDogcnVsZXMuZ2VuZXNpc0hhc2hcbn07XG5cbi8vIFN0YW5kYXJkIGNoZWNrcyBmb3IgYWxsIHRyYW5zYWN0aW9uc1xuZnVuY3Rpb24gc3RhbmRhcmRUeG5WYWxpZGF0aW9uKHR4bjogVHJhbnNhY3Rpb25QYXlsb2FkKSB7XG4gIGNvbnN0IHJvdW5kc1ZhbGlkID0gdHhuLmxhc3RSb3VuZCA+IHR4bi5maXJzdFJvdW5kO1xuICByZXR1cm4gcm91bmRzVmFsaWQ7XG59XG5cbi8qKlxuICogVGVzdCBmb3IgYSB2YWxpZCBwYXltZW50IHRyYW5zYWN0aW9uIHBheWxvYWRcbiAqIEBjYXRlZ29yeSBUcmFuc2FjdGlvbnNcbiAqIEBwYXJhbSB7b2JqZWN0fVxuICogQHJldHVybnMge2Jvb2xlYW59XG4gKi9cbmV4cG9ydCBmdW5jdGlvbiBwYXltZW50KHR4bjogVHJhbnNhY3Rpb25QYXlsb2FkKSB7XG4gIGNvbnN0IFBBWV9UWE5fU0NIRU1BID0gdjhuKCkuc2NoZW1hKHtcbiAgICB0bzogdjhuKCkub3B0aW9uYWwocnVsZXMuYWxnb0FkZHJlc3MpLFxuICAgIGFtb3VudDogdjhuKCkub3B0aW9uYWwocnVsZXMuYW1vdW50KSxcbiAgICBmcm9tOiBydWxlcy5hbGdvQWRkcmVzcyxcbiAgICB0eXBlOiB2OG4oKVxuICAgICAgLnN0cmluZygpXG4gICAgICAuZXhhY3QoVFJBTlNBQ1RJT05fVFlQRVMuUEFZKSxcbiAgICAuLi5UWE5fUkVRVUlSRURfRklFTERTLFxuICAgIC4uLlRYTl9PUFRJT05BTF9GSUVMRFNcbiAgfSk7XG5cbiAgcmV0dXJuIFBBWV9UWE5fU0NIRU1BLnRlc3QodHhuKSAmJiBzdGFuZGFyZFR4blZhbGlkYXRpb24odHhuKTtcbn1cblxuLyoqXG4gKiBUZXN0IGZvciBhIHZhbGlkIGNsb3NlIGFjY291bnQgdHJhbnNhY3Rpb24gcGF5bG9hZFxuICogQGNhdGVnb3J5IFRyYW5zYWN0aW9uc1xuICogQHBhcmFtIHtvYmplY3R9XG4gKiBAcmV0dXJucyB7Ym9vbGVhbn1cbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIGNsb3NlKHR4bjogVHJhbnNhY3Rpb25QYXlsb2FkKSB7XG4gIGNvbnN0IENMT1NFX1RYTl9TQ0hFTUEgPSB2OG4oKS5zY2hlbWEoe1xuICAgIGNsb3NlUmVtYWluZGVyVG86IHJ1bGVzLmFsZ29BZGRyZXNzLFxuICAgIGZyb206IHJ1bGVzLmFsZ29BZGRyZXNzLFxuICAgIHRvOiBydWxlcy5hbGdvQWRkcmVzcyxcbiAgICB0eXBlOiB2OG4oKVxuICAgICAgLnN0cmluZygpXG4gICAgICAuZXhhY3QoVFJBTlNBQ1RJT05fVFlQRVMuUEFZKSxcbiAgICAuLi5UWE5fUkVRVUlSRURfRklFTERTLFxuICAgIC4uLlRYTl9PUFRJT05BTF9GSUVMRFNcbiAgfSk7XG4gIC8vIE5vIGNsb3NpbmcgYW5kIHNlbmRpbmcgZnJvbSB0aGUgc2FtZSBhZGRyZXNzXG4gIGNvbnN0IGlzTm90U2FtZUFkZHJlc3MgPSB0eG4uY2xvc2VSZW1haW5kZXJUbyAhPT0gdHhuLmZyb207XG4gIHJldHVybiAoXG4gICAgQ0xPU0VfVFhOX1NDSEVNQS50ZXN0KHR4bikgJiYgc3RhbmRhcmRUeG5WYWxpZGF0aW9uKHR4bikgJiYgaXNOb3RTYW1lQWRkcmVzc1xuICApO1xufVxuXG4vKipcbiAqIFRlc3QgZm9yIGEgdmFsaWQgb25saW5lIGtleSByZWdpc3RyYXRpb24gdHJhbnNhY3Rpb24gcGF5bG9hZFxuICogQGNhdGVnb3J5IFRyYW5zYWN0aW9uc1xuICogQHBhcmFtIHtvYmplY3R9XG4gKiBAcmV0dXJucyB7Ym9vbGVhbn1cbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIHJlZ2lzdGVyS2V5T25saW5lKHR4bjogVHJhbnNhY3Rpb25QYXlsb2FkKSB7XG4gIGNvbnN0IGlzVmFsaWQgPSB2OG4oKS5zY2hlbWEoe1xuICAgIHNlbGVjdGlvbktleTogcnVsZXMuc2VsZWN0aW9uS2V5LFxuICAgIGZyb206IHJ1bGVzLmFsZ29BZGRyZXNzLFxuICAgIHZvdGVGaXJzdDogcnVsZXMudm90ZUZpcnN0LFxuICAgIHZvdGVLZXlEaWx1dGlvbjogcnVsZXMudm90ZUtleURpbHV0aW9uLFxuICAgIHZvdGVLZXk6IHJ1bGVzLnZvdGVLZXksXG4gICAgdm90ZUxhc3Q6IHJ1bGVzLnZvdGVMYXN0LFxuICAgIHR5cGU6IHY4bigpXG4gICAgICAuc3RyaW5nKClcbiAgICAgIC5leGFjdChUUkFOU0FDVElPTl9UWVBFUy5LRVlSRUcpLFxuICAgIC4uLlRYTl9SRVFVSVJFRF9GSUVMRFMsXG4gICAgLi4uVFhOX09QVElPTkFMX0ZJRUxEU1xuICB9KTtcblxuICAvLyBWb3RlIGZpcnN0IG11c3QgYmUgbGVzcyB0aGFuIHZvdGUgbGFzdFxuICBjb25zdCBpc05vdFNhbWVBZGRyZXNzID0gdHhuLnZvdGVGaXJzdCA8IHR4bi52b3RlTGFzdDtcbiAgcmV0dXJuIGlzVmFsaWQudGVzdCh0eG4pICYmIHN0YW5kYXJkVHhuVmFsaWRhdGlvbih0eG4pO1xufVxuXG4vKipcbiAqIFRlc3QgZm9yIGEgdmFsaWQgb2ZmbGluZSBrZXkgcmVnaXN0cmF0aW9uIHRyYW5zYWN0aW9uIHBheWxvYWRcbiAqIEBjYXRlZ29yeSBUcmFuc2FjdGlvbnNcbiAqIEBwYXJhbSB7b2JqZWN0fVxuICogQHJldHVybnMge2Jvb2xlYW59XG4gKi9cbmV4cG9ydCBmdW5jdGlvbiByZWdpc3RlcktleU9mZmxpbmUodHhuOiBUcmFuc2FjdGlvblBheWxvYWQpIHtcbiAgY29uc3QgaXNWYWxpZCA9IHY4bigpLnNjaGVtYSh7XG4gICAgZnJvbTogcnVsZXMuYWxnb0FkZHJlc3MsXG4gICAgdHlwZTogdjhuKClcbiAgICAgIC5zdHJpbmcoKVxuICAgICAgLmV4YWN0KFRSQU5TQUNUSU9OX1RZUEVTLktFWVJFRyksXG4gICAgLi4uVFhOX1JFUVVJUkVEX0ZJRUxEUyxcbiAgICAuLi5UWE5fT1BUSU9OQUxfRklFTERTXG4gIH0pO1xuICByZXR1cm4gaXNWYWxpZC50ZXN0KHR4bikgJiYgc3RhbmRhcmRUeG5WYWxpZGF0aW9uKHR4bik7XG59XG5cbi8qKlxuICogVGVzdCBmb3IgYSB2YWxpZCBhc3NldCBjcmVhdGlvbiB0cmFuc2FjdGlvbiBwYXlsb2FkXG4gKiBAY2F0ZWdvcnkgVHJhbnNhY3Rpb25zXG4gKiBAcGFyYW0ge29iamVjdH1cbiAqIEByZXR1cm5zIHtib29sZWFufVxuICovXG5leHBvcnQgZnVuY3Rpb24gYXNzZXRDcmVhdGUodHhuOiBUcmFuc2FjdGlvblBheWxvYWQpIHtcbiAgY29uc3QgaXNWYWxpZCA9IHY4bigpLnNjaGVtYSh7XG4gICAgYXNzZXRNZXRhZGF0YUhhc2g6IHY4bigpLnN0cmluZygpLFxuICAgIGFzc2V0TmFtZTogcnVsZXMuYXNzZXROYW1lLFxuICAgIGFzc2V0VVJMOiBydWxlcy5hc3NldFVSTCxcbiAgICBhc3NldENsYXdiYWNrOiBydWxlcy5hbGdvQWRkcmVzcyxcbiAgICBhc3NldERlY2ltYWxzOiBydWxlcy5hc3NldERlY2ltYWxzLFxuICAgIGFzc2V0RnJlZXplOiBydWxlcy5hbGdvQWRkcmVzcyxcbiAgICBhc3NldE1hbmFnZXI6IHJ1bGVzLmFsZ29BZGRyZXNzLFxuICAgIGFzc2V0UmVzZXJ2ZTogcnVsZXMuYWxnb0FkZHJlc3MsXG4gICAgYXNzZXRUb3RhbDogcnVsZXMuYXNzZXRUb3RhbCxcbiAgICBhc3NldFVuaXROYW1lOiBydWxlcy5hc3NldFVuaXROYW1lLFxuICAgIGZyb206IHJ1bGVzLmFsZ29BZGRyZXNzLFxuICAgIHR5cGU6IHY4bigpXG4gICAgICAuc3RyaW5nKClcbiAgICAgIC5leGFjdChUUkFOU0FDVElPTl9UWVBFUy5BQ0ZHKSxcbiAgICAuLi5UWE5fUkVRVUlSRURfRklFTERTLFxuICAgIC4uLlRYTl9PUFRJT05BTF9GSUVMRFNcbiAgfSk7XG5cbiAgcmV0dXJuIGlzVmFsaWQudGVzdCh0eG4pICYmIHN0YW5kYXJkVHhuVmFsaWRhdGlvbih0eG4pO1xufVxuXG4vKipcbiAqIFRlc3QgZm9yIGEgdmFsaWQgYXNzZXQgY29uZmlndXJhdGlvbiB0cmFuc2FjdGlvbiBwYXlsb2FkXG4gKiBAY2F0ZWdvcnkgVHJhbnNhY3Rpb25zXG4gKiBAcGFyYW0ge29iamVjdH1cbiAqIEByZXR1cm5zIHtib29sZWFufVxuICovXG5leHBvcnQgZnVuY3Rpb24gYXNzZXRDb25maWd1cmUodHhuOiBUcmFuc2FjdGlvblBheWxvYWQpIHtcbiAgY29uc3QgaXNWYWxpZCA9IHY4bigpLnNjaGVtYSh7XG4gICAgYXNzZXRDbGF3YmFjazogcnVsZXMuYWxnb0FkZHJlc3MsXG4gICAgYXNzZXRGcmVlemU6IHJ1bGVzLmFsZ29BZGRyZXNzLFxuICAgIGFzc2V0TWFuYWdlcjogcnVsZXMuYWxnb0FkZHJlc3MsXG4gICAgYXNzZXRSZXNlcnZlOiBydWxlcy5hbGdvQWRkcmVzcyxcbiAgICBhc3NldEluZGV4OiBydWxlcy5hc3NldEluZGV4LFxuICAgIGZyb206IHJ1bGVzLmFsZ29BZGRyZXNzLFxuICAgIHR5cGU6IHY4bigpXG4gICAgICAuc3RyaW5nKClcbiAgICAgIC5leGFjdChUUkFOU0FDVElPTl9UWVBFUy5BQ0ZHKSxcbiAgICAuLi5UWE5fUkVRVUlSRURfRklFTERTLFxuICAgIC4uLlRYTl9PUFRJT05BTF9GSUVMRFNcbiAgfSk7XG5cbiAgcmV0dXJuIGlzVmFsaWQudGVzdCh0eG4pICYmIHN0YW5kYXJkVHhuVmFsaWRhdGlvbih0eG4pO1xufVxuXG4vKipcbiAqIFRlc3QgZm9yIGEgdmFsaWQgYXNzZXQgZGVzdHJveSB0cmFuc2FjdGlvbiBwYXlsb2FkXG4gKiBAY2F0ZWdvcnkgVHJhbnNhY3Rpb25zXG4gKiBAcGFyYW0ge29iamVjdH1cbiAqIEByZXR1cm5zIHtib29sZWFufVxuICovXG5leHBvcnQgZnVuY3Rpb24gYXNzZXREZXN0cm95KHR4bjogVHJhbnNhY3Rpb25QYXlsb2FkKSB7XG4gIGNvbnN0IGlzVmFsaWQgPSB2OG4oKS5zY2hlbWEoe1xuICAgIGFzc2V0SW5kZXg6IHJ1bGVzLmFzc2V0SW5kZXgsXG4gICAgZnJvbTogcnVsZXMuYWxnb0FkZHJlc3MsXG4gICAgdHlwZTogdjhuKClcbiAgICAgIC5zdHJpbmcoKVxuICAgICAgLmV4YWN0KFRSQU5TQUNUSU9OX1RZUEVTLkFDRkcpLFxuICAgIC4uLlRYTl9SRVFVSVJFRF9GSUVMRFMsXG4gICAgLi4uVFhOX09QVElPTkFMX0ZJRUxEU1xuICB9KTtcbiAgcmV0dXJuIGlzVmFsaWQudGVzdCh0eG4pICYmIHN0YW5kYXJkVHhuVmFsaWRhdGlvbih0eG4pO1xufVxuXG4vKipcbiAqIFRlc3QgZm9yIGEgdmFsaWQgYXNzZXQgb3B0LWluIHRyYW5zYWN0aW9uIHBheWxvYWRcbiAqIEBjYXRlZ29yeSBUcmFuc2FjdGlvbnNcbiAqIEBwYXJhbSB7b2JqZWN0fVxuICogQHJldHVybnMge2Jvb2xlYW59XG4gKi9cbmV4cG9ydCBmdW5jdGlvbiBhc3NldE9wdEluKHR4bjogVHJhbnNhY3Rpb25QYXlsb2FkKSB7XG4gIGNvbnN0IGlzVmFsaWQgPSB2OG4oKS5zY2hlbWEoe1xuICAgIHRvOiBydWxlcy5hbGdvQWRkcmVzcyxcbiAgICBmcm9tOiBydWxlcy5hbGdvQWRkcmVzcyxcbiAgICB0eXBlOiB2OG4oKVxuICAgICAgLnN0cmluZygpXG4gICAgICAuZXhhY3QoVFJBTlNBQ1RJT05fVFlQRVMuQVhGRVIpLFxuICAgIGFzc2V0SW5kZXg6IHJ1bGVzLmFzc2V0SW5kZXgsXG4gICAgLi4uVFhOX1JFUVVJUkVEX0ZJRUxEUyxcbiAgICAuLi5UWE5fT1BUSU9OQUxfRklFTERTXG4gIH0pO1xuICByZXR1cm4gaXNWYWxpZC50ZXN0KHR4bikgJiYgc3RhbmRhcmRUeG5WYWxpZGF0aW9uKHR4bik7XG59XG5cbi8qKlxuICogVGVzdCBmb3IgYSB2YWxpZCBhc3NldCB0cmFuc2ZlciB0cmFuc2FjdGlvbiBwYXlsb2FkXG4gKiBAY2F0ZWdvcnkgVHJhbnNhY3Rpb25zXG4gKiBAcGFyYW0ge29iamVjdH1cbiAqIEByZXR1cm5zIHtib29sZWFufVxuICovXG5leHBvcnQgZnVuY3Rpb24gYXNzZXRUcmFuc2Zlcih0eG46IFRyYW5zYWN0aW9uUGF5bG9hZCkge1xuICBjb25zdCBpc1ZhbGlkID0gdjhuKCkuc2NoZW1hKHtcbiAgICBhbW91bnQ6IHJ1bGVzLmFtb3VudCxcbiAgICB0bzogcnVsZXMuYWxnb0FkZHJlc3MsXG4gICAgZnJvbTogcnVsZXMuYWxnb0FkZHJlc3MsXG4gICAgYXNzZXRJbmRleDogcnVsZXMuYXNzZXRJbmRleCxcbiAgICB0eXBlOiB2OG4oKVxuICAgICAgLnN0cmluZygpXG4gICAgICAuZXhhY3QoVFJBTlNBQ1RJT05fVFlQRVMuQVhGRVIpLFxuICAgIC4uLlRYTl9SRVFVSVJFRF9GSUVMRFMsXG4gICAgLi4uVFhOX09QVElPTkFMX0ZJRUxEU1xuICB9KTtcbiAgcmV0dXJuIGlzVmFsaWQudGVzdCh0eG4pICYmIHN0YW5kYXJkVHhuVmFsaWRhdGlvbih0eG4pO1xufVxuXG4vKipcbiAqIFRlc3QgZm9yIGEgdmFsaWQgcmV2b2tlIGFzc2V0IHRyYW5zYWN0aW9uIHBheWxvYWRcbiAqIEBjYXRlZ29yeSBUcmFuc2FjdGlvbnNcbiAqIEBwYXJhbSB7b2JqZWN0fVxuICogQHJldHVybnMge2Jvb2xlYW59XG4gKi9cbmV4cG9ydCBmdW5jdGlvbiBhc3NldFJldm9rZSh0eG46IFRyYW5zYWN0aW9uUGF5bG9hZCkge1xuICBjb25zdCBpc1ZhbGlkID0gdjhuKCkuc2NoZW1hKHtcbiAgICBhbW91bnQ6IHJ1bGVzLmFtb3VudCxcbiAgICB0bzogcnVsZXMuYWxnb0FkZHJlc3MsXG4gICAgYXNzZXRSZXZvY2F0aW9uVGFyZ2V0OiBydWxlcy5hbGdvQWRkcmVzcyxcbiAgICBmcm9tOiBydWxlcy5hbGdvQWRkcmVzcyxcbiAgICBhc3NldEluZGV4OiBydWxlcy5hc3NldEluZGV4LFxuICAgIHR5cGU6IHY4bigpXG4gICAgICAuc3RyaW5nKClcbiAgICAgIC5leGFjdChUUkFOU0FDVElPTl9UWVBFUy5BWEZFUiksXG4gICAgLi4uVFhOX1JFUVVJUkVEX0ZJRUxEUyxcbiAgICAuLi5UWE5fT1BUSU9OQUxfRklFTERTXG4gIH0pO1xuICByZXR1cm4gaXNWYWxpZC50ZXN0KHR4bikgJiYgc3RhbmRhcmRUeG5WYWxpZGF0aW9uKHR4bik7XG59XG5cbi8qKlxuICogVGVzdCBmb3IgYSB2YWxpZCBmcmVlemUgYXNzZXQgdHJhbnNhY3Rpb24gcGF5bG9hZFxuICogQGNhdGVnb3J5IFRyYW5zYWN0aW9uc1xuICogQHBhcmFtIHtvYmplY3R9XG4gKiBAcmV0dXJucyB7Ym9vbGVhbn1cbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIGFzc2V0RnJlZXplKHR4bjogVHJhbnNhY3Rpb25QYXlsb2FkKSB7XG4gIGNvbnN0IGlzVmFsaWQgPSB2OG4oKS5zY2hlbWEoe1xuICAgIGZyZWV6ZVN0YXRlOiBydWxlcy5mcmVlemVTdGF0ZSxcbiAgICBmcmVlemVBY2NvdW50OiBydWxlcy5hbGdvQWRkcmVzcyxcbiAgICBhc3NldEluZGV4OiBydWxlcy5hc3NldEluZGV4LFxuICAgIGZyb206IHJ1bGVzLmFsZ29BZGRyZXNzLFxuICAgIHR5cGU6IHY4bigpXG4gICAgICAuc3RyaW5nKClcbiAgICAgIC5leGFjdChUUkFOU0FDVElPTl9UWVBFUy5BRlJaKSxcbiAgICAuLi5UWE5fUkVRVUlSRURfRklFTERTLFxuICAgIC4uLlRYTl9PUFRJT05BTF9GSUVMRFNcbiAgfSk7XG4gIHJldHVybiBpc1ZhbGlkLnRlc3QodHhuKSAmJiBzdGFuZGFyZFR4blZhbGlkYXRpb24odHhuKTtcbn1cblxuZXhwb3J0IGRlZmF1bHQge1xuICBwYXltZW50LFxuICBjbG9zZSxcbiAgcmVnaXN0ZXJLZXlPbmxpbmUsXG4gIHJlZ2lzdGVyS2V5T2ZmbGluZSxcbiAgYXNzZXRDcmVhdGUsXG4gIGFzc2V0Q29uZmlndXJlLFxuICBhc3NldERlc3Ryb3ksXG4gIGFzc2V0T3B0SW4sXG4gIGFzc2V0VHJhbnNmZXIsXG4gIGFzc2V0UmV2b2tlLFxuICBhc3NldEZyZWV6ZVxufTtcbiJdfQ==